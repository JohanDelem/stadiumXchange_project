{% extends 'base.html.twig' %}

{% block title %}Ticket{% endblock %}
{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/ticketDetail.css') }}">
    <style>
        /* Style de la modal */
        .modal {
            display: none; /* Masqué par défaut */
            position: fixed; /* Rester en place */
            z-index: 1; /* Au-dessus des autres éléments */
            left: 0;
            top: 0;
            width: 100%; /* Plein écran */
            height: 100%; /* Plein écran */
            overflow: auto; /* Activer le défilement si nécessaire */
            background-color: rgba(0, 0, 0, 0.4); /* Fond semi-transparent */
        }

        /* Contenu de la modal */
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto; /* Centré */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* Largeur de la modal */
            max-width: 500px; /* Largeur max */
        }

        .modal-buttons {
            display: flex;
            justify-content: space-between; /* Espacement entre les boutons */
        }
    </style>
{% endblock %}
{% block body %}
    <h1>Ticket</h1>

    <table class="table">
        <tbody>
            <tr>
                <th>Equipe à domicile</th>
                <td>{{ ticket.homeTeam }}</td>
            </tr>
            <tr>
                <th></th>
                <td>VS</td>
            </tr>
            <tr>
                <th>Equipe à l'extérieur</th>
                <td>{{ ticket.awayTeam }}</td>
            </tr>
            <tr>
                <th>Date et heure</th>
                <td>{{ ticket.dateTime ? ticket.dateTime|date('Y-m-d H:i:s') : '' }}</td>
            </tr>
            <tr>
                <th>Prix</th>
                <td>{{ ticket.price }} euros</td>
            </tr>
            <tr>
                <th>Stade</th>
                <td>{{ ticket.stadium }}</td>
            </tr>
            <tr>
                <th>Utilisateur</th>
                <td>
                    {% if ticket.owner %}
                        <p>{{ ticket.owner.lastname }} {{ ticket.owner.firstname }}</p>
                    {% else %}
                        <p>Inconnu</p>
                    {% endif %}
                </td>
            </tr>
            <tr>
                <th>Compétition</th>
                <td>{{ ticket.competition }}</td>
            </tr>
        </tbody>
    </table>

    <button class="buy-button" data-ticket-id="{{ ticket.id }}">Acheter</button>

    <div id="confirmModal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>Confirmation d'achat</h2> 
            <p>Let's goooo plus qu'un clic et le billet est à toi mon pote !</p> 
            <form id="deleteForm" method="post">
                <input type="hidden" name="_token" value="{{ csrf_token('ticket_purchase_' ~ ticket.id) }}">
                <input type="hidden" name="ticket_id" value="{{ ticket.id }}">
                <div class="modal-buttons">
                    <button type="submit" id="confirmDelete" class="confirm-button">Mais bien sûr j'achète t'es un fada toi !</button> 
                    <button type="button" class="cancel-button">Et weee la daronne a besoin de moi...</button> 
                </div>
            </form>
        </div>
    </div>

{% block javascripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('confirmModal');
    const deleteForm = document.getElementById('deleteForm');
    const csrfTokenField = deleteForm.querySelector('input[name="_token"]');

    function openModal(id) {
        // Met à jour l'action du formulaire pour acheter le ticket
        deleteForm.action = '{{ path('app_ticket_buy', {id: 'ticket_id'}) }}'.replace('ticket_id', id);
        modal.style.display = 'block'; // Affiche la modal
    }

    function closeModal() {
        modal.style.display = 'none'; // Ferme la modal
    }

    // Ouvre la modal quand on clique sur le bouton "Acheter"
    document.querySelector('.buy-button').addEventListener('click', function() {
        const ticketId = this.getAttribute('data-ticket-id');
        openModal(ticketId);
    });

    // Ferme la modal quand on clique sur le bouton d'annulation
    document.querySelector('.cancel-button').addEventListener('click', closeModal);

    // Ferme la modal si on clique en dehors
    window.onclick = function(event) {
        if (event.target == modal) {
            closeModal();
        }
    };
});
</script>
{% endblock %}
{% endblock %}