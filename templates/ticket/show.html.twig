{% extends 'base.html.twig' %}

{% block title %}Détails du Ticket - Stadium Xchange{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('css/tailwind.css') }}" rel="stylesheet">
    <style>
        body {
            background-image: url('../images/Background_image2.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
    </style>
{% endblock %}

{% block body %}
<div class="min-h-screen bg-black bg-opacity-70 flex flex-col">
    <header class="bg-black py-4 shadow-md">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-yellow-500">Détails du Ticket</h1>
            <a href="{{ path('app_home_page') }}" class="text-white hover:text-yellow-500 transition duration-300">Retour à l'accueil</a>
        </div>
    </header>

    <main class="flex-grow container mx-auto px-4 py-8">
        {# Affichage des messages flash #}
        {% for message in app.session.flashBag.get('error') %}
        <div class="alert alert-danger bg-red-500 text-white p-4 rounded mb-4">
            {{ message|raw }} {# Utilisation de 'raw' pour interpréter le HTML #}
        </div>
    {% endfor %}
    

        <div class="bg-gray-900 bg-opacity-80 rounded-lg shadow-xl p-6 mb-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <h2 class="text-2xl font-bold text-yellow-500 mb-4">{{ ticket.homeTeam }} vs {{ ticket.awayTeam }}</h2>
                    <p class="text-white"><span class="font-semibold">Date et heure :</span> {{ ticket.dateTime ? ticket.dateTime|date('d/m/Y H:i') : '' }}</p>
                    <p class="text-white"><span class="font-semibold">Stade :</span> {{ ticket.stadium }}</p>
                    <p class="text-white"><span class="font-semibold">Compétition :</span> {{ ticket.competition }}</p>
                </div>
                <div class="space-y-4">
                    <p class="text-2xl font-bold text-yellow-500"><span class="text-white">Prix :</span> {{ ticket.price }} €</p>
                    <p class="text-white"><span class="font-semibold">Vendeur :</span> 
                        {% if ticket.owner %}
                            {{ ticket.owner.lastname }} {{ ticket.owner.firstname }}
                        {% else %}
                            Inconnu
                        {% endif %}
                    </p>
                    <button class="buy-button bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-3 px-6 rounded-full transition duration-300 mt-4" data-ticket-id="{{ ticket.id }}">
                        Acheter ce billet
                    </button>
                </div>
            </div>
        </div>
    </main>

    <footer class="bg-black text-white py-4">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2024 Stadium Xchange - Tous droits réservés.</p>
        </div>
    </footer>

    <!-- Modal de confirmation -->
    <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center">
        <div class="bg-white rounded-lg p-8 max-w-md w-full">
            <h2 class="text-2xl font-bold mb-4">Confirmation d'achat</h2>
            <p class="mb-6">Let's goooo plus qu'un clic et le billet est à toi !</p>
            <form id="deleteForm" method="post">
                <input type="hidden" name="_token" value="{{ csrf_token('ticket_purchase_' ~ ticket.id) }}">
                <input type="hidden" name="ticket_id" value="{{ ticket.id }}">
                <div class="flex justify-end space-x-4">
                    <button type="submit" id="confirmDelete" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded transition duration-300">Confirmer</button>
                    <button type="button" class="cancel-button bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded transition duration-300">Annuler</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const modal = document.getElementById('confirmModal');
    const deleteForm = document.getElementById('deleteForm');

    function openModal(id) {
        deleteForm.action = '{{ path('app_ticket_buy', {id: 'ticket_id'}) }}'.replace('ticket_id', id);
        modal.classList.remove('hidden');
        modal.classList.add('flex');
    }

    function closeModal() {
        modal.classList.add('hidden');
        modal.classList.remove('flex');
    }

    document.querySelector('.buy-button').addEventListener('click', function() {
        const ticketId = this.getAttribute('data-ticket-id');
        openModal(ticketId);
    });

    document.querySelector('.cancel-button').addEventListener('click', closeModal);

    window.onclick = function(event) {
        if (event.target == modal) {
            closeModal();
        }
    };
});
</script>
{% endblock %}
