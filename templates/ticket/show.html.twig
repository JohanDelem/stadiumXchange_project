{% extends 'base.html.twig' %}

{% block title %}Ticket{% endblock %}
{% block stylesheets %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="icon" type="image/x-icon" href="{{ asset('images/icon.png') }}">
{% endblock %}
{% block body %}
    <div class="container mt-5">
        <h1 class="text-center mb-4">Détails du Ticket</h1>

        <div class="card shadow-sm">
            <div class="card-body">
                <table class="table table-borderless">
                    <tbody>
                        <tr>
                            <th scope="row" class="text-primary">Équipe à domicile</th>
                            <td class="fw-bold">{{ ticket.homeTeam }}</td>
                        </tr>
                        <tr>
                            <th scope="row"></th>
                            <td class="text-center fw-bold">VS</td>
                        </tr>
                        <tr>
                            <th scope="row" class="text-primary">Équipe à l'extérieur</th>
                            <td class="fw-bold">{{ ticket.awayTeam }}</td>
                        </tr>
                        <tr>
                            <th scope="row" class="text-primary">Date et heure</th>
                            <td>{{ ticket.dateTime ? ticket.dateTime|date('Y-m-d H:i:s') : '' }}</td>
                        </tr>
                        <tr>
                            <th scope="row" class="text-primary">Prix</th>
                            <td>{{ ticket.price }} euros</td>
                        </tr>
                        <tr>
                            <th scope="row" class="text-primary">Stade</th>
                            <td>{{ ticket.stadium }}</td>
                        </tr>
                        <tr>
                            <th scope="row" class="text-primary">Utilisateur</th>
                            <td>
                                {% if ticket.owner %}
                                    <p>{{ ticket.owner.lastname }} {{ ticket.owner.firstname }}</p>
                                {% else %}
                                    <p>Inconnu</p>
                                {% endif %}
                            </td>
                        </tr>
                        <tr>
                            <th scope="row" class="text-primary">Compétition</th>
                            <td>{{ ticket.competition }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="text-center mt-4">
            <button class="btn btn-primary" data-ticket-id="{{ ticket.id }}">Acheter</button>
        </div>
    </div>

    <!-- Modal de confirmation -->
    <div id="confirmModal" class="modal fade" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmModalLabel">Confirmation d'achat</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Let's goooo, plus qu'un clic et le billet est à toi mon pote !</p>
                    <form id="deleteForm" method="post">
                        <input type="hidden" name="_token" value="{{ csrf_token('ticket_purchase_' ~ ticket.id) }}">
                        <input type="hidden" name="ticket_id" value="{{ ticket.id }}">
                </div>
                <div class="modal-footer">
                    <button type="submit" id="confirmDelete" class="btn btn-success">Confirmer</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    {% block javascripts %}
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const modal = new bootstrap.Modal(document.getElementById('confirmModal'));
        const deleteForm = document.getElementById('deleteForm');

        function openModal(id) {
            // Met à jour l'action du formulaire pour acheter le ticket
            deleteForm.action = '{{ path('app_ticket_buy', {id: 'ticket_id'}) }}'.replace('ticket_id', id);
            modal.show(); // Affiche la modal
        }

        // Ouvre la modal quand on clique sur le bouton "Acheter"
        document.querySelector('.buy-button').addEventListener('click', function() {
            const ticketId = this.getAttribute('data-ticket-id');
            openModal(ticketId);
        });
    });
    </script>
    {% endblock %}
    </div>
{% endblock %}